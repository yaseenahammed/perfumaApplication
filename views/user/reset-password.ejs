<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfuma - Reset Password</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="min-h-screen bg-gray-50">
    <div class="flex min-h-screen">
        <!-- Left Side - Full Image -->
        <div class="w-1/2 bg-gradient-to-br from-rose-100 to-amber-50 relative overflow-hidden">
            <div class="absolute inset-0 flex items-center justify-center">
                <img src="https://t3.ftcdn.net/jpg/08/32/30/12/360_F_832301227_1iQHc794dGkUn4VQLlarNKnV1UvpZSLq.jpg" alt="Perfuma Fragrance" class="w-full h-full object-cover">
            </div>
            <div class="absolute inset-0 bg-black bg-opacity-20"></div>
            <div class="absolute top-8 left-8">
                <a href="/" class="text-white hover:text-amber-200 transition duration-200">
                    <i class="fas fa-home text-xl"></i>
                </a>
            </div>
            <div class="absolute bottom-8 left-8 right-8 text-center">
                <div class="flex justify-center space-x-4 mb-4">
                    <div class="w-12 h-12 bg-white/30 rounded-full flex items-center justify-center backdrop-blur-sm">
                        <i class="fas fa-lock text-lg text-white"></i>
                    </div>
                    <div class="w-12 h-12 bg-white/30 rounded-full flex items-center justify-center backdrop-blur-sm">
                        <i class="fas fa-key text-lg text-white"></i>
                    </div>
                    <div class="w-12 h-12 bg-white/30 rounded-full flex items-center justify-center backdrop-blur-sm">
                        <i class="fas fa-shield-check text-lg text-white"></i>
                    </div>
                </div>
                <h3 class="text-white text-xl font-semibold">Secure Reset</h3>
                <p class="text-white/80 text-sm mt-2">Create your new password</p>
            </div>
        </div>

        <!-- Right Side - Reset Password Form -->
        <div class="w-1/2 flex items-center justify-center p-8">
            <div class="max-w-md w-full space-y-8">
                <!-- Header -->
                <div class="text-center">
                    <h1 class="text-4xl font-bold text-gray-900 tracking-wide">PERFUMA</h1>
                    <p class="mt-2 text-gray-600">Reset Password</p>
                    <p class="mt-1 text-sm text-gray-500">Create a new secure password for your account</p>
                </div>

                <!-- Reset Password Form Container -->
                <div class="bg-white p-8 rounded-xl shadow-lg border border-gray-200">
                    <!-- Reset Password Form -->
                    <form onsubmit="return resetPasswordForm()" class="space-y-6">
                      
                        <div>
                            <label for="newPassword" class="block text-sm font-medium text-gray-700 mb-2">New Password</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i class="fas fa-lock text-gray-400"></i>
                                </div>
                                <input 
                                    type="password" 
                                    id="newPassword" 
                                    name="newPassword" 
                                 
                                    class="block w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent transition duration-200"
                                    placeholder="Enter new password"
                                >
                                <button 
                                    type="button" 
                                    id="toggleNewPassword"
                                    class="absolute inset-y-0 right-0 pr-3 flex items-center"
                                >
                                    <i class="fas fa-eye text-gray-400 hover:text-gray-600"></i>
                                </button>
                            </div>
                            <div id="newPasswordError" class="mt-1 text-sm text-red-600 hidden"></div>
                        </div>

                        <!-- Confirm Password Field -->
                        <div>
                            <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-2">Confirm Password</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i class="fas fa-lock text-gray-400"></i>
                                </div>
                                <input 
                                    type="password" 
                                    id="confirmPassword" 
                                    name="confirmPassword" 
                                  
                                    class="block w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent transition duration-200"
                                    placeholder="Confirm new password"
                                >
                                <button 
                                    type="button" 
                                    id="toggleConfirmPassword"
                                    class="absolute inset-y-0 right-0 pr-3 flex items-center"
                                >
                                    <i class="fas fa-eye text-gray-400 hover:text-gray-600"></i>
                                </button>
                            </div>
                            <div id="confirmPasswordError" class="mt-1 text-sm text-red-600 hidden"></div>
                        </div>

                        <!-- Password Requirements -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex">
                                <i class="fas fa-info-circle text-blue-400 mr-2 mt-0.5"></i>
                                <div>
                                    <p class="text-sm text-blue-700 font-medium">Password Requirements:</p>
                                    <ul class="text-xs text-blue-600 mt-1 list-disc list-inside">
                                        <li>At least 6 characters long</li>
                                        <li>Must contain letters and numbers</li>
                                        <li>Both passwords must match</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div>
                            <button 
                                type="submit" 
                                class="w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition duration-200 transform hover:scale-105"
                            >
                                <span class="flex items-center">
                                    <i class="fas fa-shield-check mr-2"></i>
                                    Reset Password
                                </span>
                            </button>
                        </div>

                        <!-- Server Error Message -->
                        <% if (locals.message && message.length > 0) { %>
                        <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                            <div class="flex">
                                <i class="fas fa-exclamation-circle text-red-400 mr-2 mt-0.5"></i>
                                <p class="text-sm text-red-700"><%= message %></p>
                            </div>
                        </div>
                        <% } %>
                    </form>
                </div>

                <!-- Back to Login -->
                <div class="text-center">
                    <p class="text-sm text-gray-600">
                        Back to 
                        <a href="/login" class="font-medium text-amber-600 hover:text-amber-500 transition duration-200">
                            Login
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function validateForm() {
            let valid = true;
            const newPassword = document.getElementById('newPassword');
            const confirmPassword = document.getElementById('confirmPassword');
            const newPasswordError = document.getElementById('newPasswordError');
            const confirmPasswordError = document.getElementById('confirmPasswordError');

            // Clear previous errors and styling
            newPasswordError.textContent = '';
            confirmPasswordError.textContent = '';
            newPasswordError.classList.add('hidden');
            confirmPasswordError.classList.add('hidden');
            
            // Reset input styling
            newPassword.classList.remove('border-red-500', 'focus:ring-red-500');
            newPassword.classList.add('border-gray-300', 'focus:ring-amber-500');
            confirmPassword.classList.remove('border-red-500', 'focus:ring-red-500');
            confirmPassword.classList.add('border-gray-300', 'focus:ring-amber-500');



            if (!newPassword.value.trim()) {
                newPasswordError.textContent = 'Password cannot be empty.';
                newPasswordError.classList.remove('hidden');
                newPassword.classList.add('border-red-500', 'focus:ring-red-500');
                newPassword.classList.remove('border-gray-300', 'focus:ring-amber-500');
                valid = false;
            } else if (newPassword.value.length < 6) { 
                newPasswordError.textContent = 'Password must be at least 6 characters long.';
                newPasswordError.classList.remove('hidden');
                newPassword.classList.add('border-red-500', 'focus:ring-red-500');
                newPassword.classList.remove('border-gray-300', 'focus:ring-amber-500');
                valid = false;
            }

            if (!confirmPassword.value.trim()) {
                confirmPasswordError.textContent = 'Please re-enter your password.';
                confirmPasswordError.classList.remove('hidden');
                confirmPassword.classList.add('border-red-500', 'focus:ring-red-500');
                confirmPassword.classList.remove('border-gray-300', 'focus:ring-amber-500');
                valid = false;
            } else if (confirmPassword.value !== newPassword.value) {
                confirmPasswordError.textContent = 'Passwords do not match.';
                confirmPasswordError.classList.remove('hidden');
                confirmPassword.classList.add('border-red-500', 'focus:ring-red-500');
                confirmPassword.classList.remove('border-gray-300', 'focus:ring-amber-500');
                valid = false;
            }else {
    const hasAlphabet = /[A-Za-z]/.test(newPassword.value);
    const hasDigit = /[0-9]/.test(newPassword.value);
    if (!hasAlphabet || !hasDigit) {
        newPasswordError.textContent = 'Password must contain both letters and numbers.';
        newPasswordError.classList.remove('hidden');
        newPassword.classList.add('border-red-500', 'focus:ring-red-500');
        valid = false;
    }
  }
            return valid;
        }

        function resetPasswordForm() {
            if (!validateForm()) {
                return false; // Prevent submission if validation fails
            }

            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            console.log('Submitting password reset:', { newPassword, confirmPassword });

             

            $.ajax({
                type: 'POST',
                url: '/reset-password',
                data: { newPassword, confirmPassword },
                xhrFields: { withCredentials: true },
                success: function(response) {
                    console.log('Server response:', response);
                    if (response.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Password reset successfully',
                            showConfirmButton: false,
                            timer: 1500
                        }).then(() => {
                            window.location.href = response.redirectUrl;
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: response.message
                        });
                    }
                },
                error: function(xhr, status, error) {
                    console.error('AJAX error:', status, error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Failed to reset password. Please try again.'
                    });
                }
            });
            return false; // Prevent default form submission
        }

        // Toggle password visibility for new password
        document.getElementById('toggleNewPassword').addEventListener('click', function() {
            const passwordInput = document.getElementById('newPassword');
            const icon = this.querySelector('i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        });

        // Toggle password visibility for confirm password
        document.getElementById('toggleConfirmPassword').addEventListener('click', function() {
            const passwordInput = document.getElementById('confirmPassword');
            const icon = this.querySelector('i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        });

        // Clear errors when user starts typing
        document.getElementById('newPassword').addEventListener('input', function() {
            const errorElement = document.getElementById('newPasswordError');
            errorElement.classList.add('hidden');
            this.classList.remove('border-red-500', 'focus:ring-red-500');
            this.classList.add('border-gray-300', 'focus:ring-amber-500');
        });

        document.getElementById('confirmPassword').addEventListener('input', function() {
            const errorElement = document.getElementById('confirmPasswordError');
            errorElement.classList.add('hidden');
            this.classList.remove('border-red-500', 'focus:ring-red-500');
            this.classList.add('border-gray-300', 'focus:ring-amber-500');
        });

        // Focus on first input when page loads
        document.getElementById('newPassword').focus();
    </script>
</body>
</html>